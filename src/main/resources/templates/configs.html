<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
	integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
	crossorigin="anonymous">
<link href="/css/styles.css" rel="stylesheet" />
<title>Vuper</title>
</head>

<body class="bg-light">
	<nav class="navbar navbar-dark bg-dark shadow-sm">
		<div class="container-fluid">
			<span class="navbar-brand mb-0 h1">Vuper</span>
			<div class="ml-auto">
				<a th:href="@{/web/configs}" class="btn btn-default ml-auto"> <svg
						xmlns="http://www.w3.org/2000/svg" width="16" height="16"
						fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
  <path
							d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z" />
  <path
							d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z" />
</svg>
				</a>
			</div>
		</div>
	</nav>

	<div class="container-fluid">
		<div class="row">
			<div class="col-12 p-0 bg-light">
				<ul class="nav">
					<li class="nav-item"><a class="nav-link vuper-nav-item"
						th:href="@{/web/estruturas}">Estruturas</a></li>
					<li class="nav-item"><a class="nav-link vuper-nav-item"
						th:href="@{/web/pecas}">Peças</a></li>
				</ul>
			</div>
		</div>
	</div>

	<div class="container-fluid p-3">
		<div class="row">

			<div class="col-4">
				<form id="categorias-form">
					<div class="card">
						<div class="card-header">Categorias</div>
						<div class="card-body">
							<div class="custom-file">
								<input type="file" class="custom-file-input bg-success"
									id="categorias-input" required name="file"> <label
									id="categorias-label" class="custom-file-label"
									for="categorias-input">Importar categorias</label>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="col-4">
				<form id="pecas-form">
					<div class="card">
						<div class="card-header">Peças</div>
						<div class="card-body">
							<div class="custom-file">
								<input type="file" class="custom-file-input" id="pecas-input"
									name="file" required> <label class="custom-file-label"
									for="pecas-input">Importar peças</label>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="col-4">
				<div class="card">
					<div class="card-header">Estruturas</div>
					<div class="card-body">
						<div class="custom-file">
							<input type="file" class="custom-file-input"
								id="estruturas-input" required> <label
								class="custom-file-label" for="estruturas-input">Importar
								estrutura</label>
						</div>
					</div>
				</div>
			</div>
			
		</div>
		<div class="row">
			<div class="col-12 d-flex justify-content-center" id="upload-error-container">
				
			</div>
		</div>

	</div>
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
		integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
		crossorigin="anonymous"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
		crossorigin="anonymous"></script>
	<script type="text/javascript"
		src="/js/controller/upload-error.controller.js"></script>
	<script type="text/javascript" src="/js/view/upload-error.view.js"></script>
	<script>
		const configs = {
			"categorias" : false,
			"pecas" : false,
			"estruturas" : false
		};

		$(document).ready(
				function() {
					console.log("configs");

					$("#pecas-input").change(
							function() {
								console.log("::: pecas input changed");

								const pecasForm = document
										.getElementById("pecas-form");
								var formData = new FormData(pecasForm);

								fetch("/web/configs/pecas", {
									method : "POST",
									body : formData
								}).then(function(response) {
									
									if(!response.ok) {
										
										response.json().then(function (data) {
											const view = new UploadErrorView(data).view();
											$("#upload-error-container").html(view);
											
										});	
									}
								});
							});

					$("#categorias-input").change(
							function() {
								console.log("::: categorias input changed");

								const categoriasForm = document
										.getElementById("categorias-form");
								var formData = new FormData(categoriasForm);

								fetch("/web/configs/categorias", {
									method : "POST",
									body : formData,
								});

							});

					fetch("/api/configs").then(function(response) {
						return response.json();
					}).then(
							function(data) {

								data.forEach(function(item) {

									if (item.configured) {

										$(`#${item.name}-input`).prop(
												"disabled", true);
										$(`#${item.name}-label`).text(
												"Configurado");
										$(`#${item.name}-label`).css(
												"border-color", "#28a745");
									}
								});
							});
				});
	</script>
</body>

</html>
